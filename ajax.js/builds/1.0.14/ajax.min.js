/*
 Ajax.JS
 @author	Tom Flidr | tomflidr(at)gmail(dot)com
 @url		https://github.com/tomFlidr/ajax.js
 @licence	https://tomflidr.github.io/ajax.js/LICENSE.md
 @version	1.0.14
 @date		2023-08-07
 @example

    var xhr = Ajax.load(<Ajax.cfg.Load>{
       url: 'https://tomflidr.github.io/ajax.js/books.json',
       method: 'POST', // GET|POST|OPTION|HEAD...
       data: { anything: ["to", "serialize"] },
       success: (data?: any, statusCode?: number, xhr?: XMLHttpRequest|null, requestId?: number, url?: string, type?: string) => {},
       type: 'json', // json|jsonp|xml|html|text
       error: (responseText?: string, statusCode?: number, xhr?: XMLHttpRequest|null, errorObj?: Error|null, errorEvent?: Event|null, requestId?: number, url?: string, type?: string) => {},
       headers: {},
       cache: false,
       async: true
    });

*/
(function(p){p.Ajax=p.Ajax||function(){function e(){}e.handlers={before:[],success:[],abort:[],error:[]};e.defaultHeaders={"X-Requested-With":"XmlHttpRequest","Content-Type":"application/x-www-form-urlencoded"};e.jsonpCallbackParam="callback";e.cacheBusterParamName="_";e.aa="JsonpCallback";e.J=0;e.beforeLoad=function(a){e.handlers.before.push(a);return e};e.onSuccess=function(a){e.handlers.success.push(a);return e};e.onAbort=function(a){e.handlers.abort.push(a);return e};e.onError=function(a){e.handlers.error.push(a);
return e};e.get=function(){var a=new e;return a.o.apply(a,[].slice.apply(arguments)).s()};e.post=function(){var a=new e;return a.o.apply(a,[].slice.apply(arguments)).s("post")};e.load=function(a){return(new e).o(a.url,a.data,a.success,a.type,a.error,a.headers,a.cache,a.async).s(a.method)};e.prototype={toString:function(){return"[object Ajax]"},o:function(a,b,d,c,f,h,g,k){function l(){}this.url=a||"";this.data=b||{};this.b=d||l;this.type=(void 0===c?"":c).toLowerCase()||"auto";this.error=f||l;this.headers=
h||{};this.cache=null==g?!1:g;this.async=null==k?!0:k;this.result={b:!1,data:{}};this.f=this.c=null;return this},s:function(a){this.g=!!document.all;return"jsonp"==this.type?this.S():this.T(a).a},S:function(){var a=this,b=document.createElement("script"),d=a.N();a.h=b;a.requestId=e.J++;a.j=e.aa+a.requestId;e[a.j]=function(c){a.P(c)};a.D("get",!0);b.setAttribute("src",a.url);a.v();a.g?(b.attachEvent("onreadystatechange",a.l()),b=d.insertAdjacentElement("beforeEnd",b)):(b.setAttribute("async","async"),
b.addEventListener("error",a.l(),!0),b=d.appendChild(b));return{url:a.url,id:a.requestId,abort:function(){a.m();a.u()}}},P:function(a){this.result.b=!0;this.m();this.result.data=a;this.b(a,200,null,this.requestId,this.url,this.type);this.B()},l:function(){var a=this,b=a.h;return a.g?function(d){d=d||window.event;"loaded"!=b.readyState||a.result.b||a.G(d)}:function(d){a.G(d)}},G:function(a){var b=this.l();this.g?this.h.detachEvent("onreadystatechange",b):this.h.removeEventListener("error",b,!0);this.m();
this.c=a;this.H();this.error("",0,null,null,a,this.requestId,this.url,this.type);this.A()},m:function(){this.h.parentNode.removeChild(this.h);this.g?e[this.j]=void 0:delete e[this.j]},T:function(a){a=(void 0===a?"get":a).toLowerCase();var b=this.D(a,!1);this.requestId=e.J++;this.a=this.K();this.U();this.a.open(a,this.url,this.async);this.ba();this.v();this.V(a,b);return this},U:function(){function a(c){4==d.readyState&&b.R(c)}var b=this,d=b.a;b.g?b.a.attachEvent("onreadystatechange",a):b.a.addEventListener("readystatechange",
a)},R:function(a){a=a||window.event;var b=this.a.status;199<b&&300>b?(this.W(),this.I()):0===b?this.u():(this.result.b=!1,this.c=a,this.f=Error("Http Status Code: "+b),this.I())},V:function(a,b){var d=this.a;"get"==a?d.send():"post"==a&&d.send(b)},I:function(){var a=this.a;this.result.b?(a=[this.result.data,a.status,a,this.requestId,this.url,this.type],this.b.apply(null,a),this.B()):(a=[a.responseText,a.status,a,this.c,this.f,this.requestId,this.url,this.type],this.error.apply(null,a),this.A(),this.H())},
W:function(){"auto"==this.type&&this.Y();this.X()},X:function(){var a=this.a;"json"==this.type?this.Z():"xml"==this.type||"html"==this.type?this.$():"text"==this.type&&(this.result.data=a.responseText,this.result.b=!0)},Y:function(){var a=this.O();this.type="text";-1<a.indexOf("javascript")||-1<a.indexOf("json")?this.type="json":-1<a.indexOf("html")?this.type="html":-1<a.indexOf("xml")&&(this.type="xml")},Z:function(){var a=window,b=this.a.responseText;a.JSON||this.F();try{this.result.data=a.JSON.parse(b),
this.result.b=!0}catch(d){try{this.result.data=(new Function("return "+b))(),this.result.b=!0}catch(c){}this.f=d}},$:function(){var a={},b=window,d=this.a.responseText,c=b.DOMParser;try{c?(a=new c,this.result.data=a.parseFromString(d,"application/xml")):(a=new b.ActiveXObject("Microsoft.XMLDOM"),a.async=!1,this.result.data=a.loadXML(d)),this.result.b=!0}catch(f){this.f=f}},O:function(){var a=this.L(),b=a.indexOf("/");-1<b&&(a=a.substr(b+1));return a},L:function(){var a=this.a.getResponseHeader("Content-Type"),
b=a.indexOf(";");a=0<a.length?a.toLowerCase():"";-1<b&&(a=a.substr(0,b));return a},K:function(){var a=window,b=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(a.XMLHttpRequest)var d=new a.XMLHttpRequest;else for(var c=0,f=b.length;c<f;c+=1)try{d=new a.ActiveXObject(b[c])}catch(h){}return d},ba:function(){var a=this.a,b=this.headers,d=e.defaultHeaders,c;for(c in b)a.setRequestHeader(c,b[c]);for(c in d)b[c]||a.setRequestHeader(c,d[c])},D:function(a,b){var d="?",c=
this.url,f=c.indexOf(d);a=a.toLowerCase();"get"==a?(a=this.C(!0),-1<f&&(d=f==c.length-1?"":"&"),c+=d+a,a=""):a=this.C(!1);this.cache||(c+="&"+e.cacheBusterParamName+"="+ +new Date);b&&(c+="&"+e.jsonpCallbackParam+"="+this.M()+"."+this.j);this.url=c;return a},C:function(a){var b=this.data;if("string"==typeof b)return b;window.JSON||this.F();return this.ca(a)},ca:function(){var a=this.data,b=[],d=window,c=d.encodeURIComponent,f;for(f in a){var h=a[f];if(null==h)b.push(f+"=");else{var g=this.da(h);if("Object"==
g)g=c(d.JSON.stringify(h)),b.push(f+"="+g);else if("Array"==g)for(var k=0,l=h.length;k<l;k++)g=c(d.JSON.stringify(h[k])),b.push(f+"[]="+g);else g=c(String(h)),b.push(f+"="+g)}}return b.join("&")},da:function(a){a=Object.prototype.toString.apply(a);return a.substring(8,a.length-1)},F:function(){window.JSON=function(){function a(c){return 10>c?"0"+c:c}function b(c,f){var h;var g=/["\\\x00-\x1f\x7f-\x9f]/g;var k;switch(typeof c){case "string":return g.test(c)?'"'+c.replace(g,function(q){var n=d[q];if(n)return n;
n=q.charCodeAt();return"\\u00"+Math.floor(n/16).toString(16)+(n%16).toString(16)})+'"':'"'+c+'"';case "number":return isFinite(c)?String(c):"null";case "boolean":case "null":return String(c);case "object":if(!c)return"null";if("function"===typeof c.toJSON)return b(c.toJSON());g=[];if("number"===typeof c.length&&!c.propertyIsEnumerable("length")){var l=c.length;for(h=0;h<l;h+=1)g.push(b(c[h],f)||"null");return"["+g.join(",")+"]"}if(f)for(l=f.length,h=0;h<l;h+=1){var m=f[h];"string"===typeof m&&(k=
b(c[m],f))&&g.push(b(m)+":"+k)}else for(m in c)"string"===typeof m&&(k=b(c[m],f))&&g.push(b(m)+":"+k);return"{"+g.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"};var d={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:b,parse:function(c,f){function h(g,k){var l;if(k&&"object"===typeof k)for(l in k)if(Object.prototype.hasOwnProperty.apply(k,
[l])){var m=h(l,k[l]);void 0!==m&&(k[l]=m)}return f(g,k)}if(/^[\],:{}\s]*$/.test(c.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return c=eval("("+c+")"),"function"===typeof f?h("",c):c;throw new SyntaxError("parseJSON");}}}()},N:function(){for(var a=document.body;null!==a.previousSibling&&void 0!==a.previousSibling&&(a=a.previousSibling,"head"!=a.nodeName.toLowerCase()););return a},v:function(){this.i("before",
"jsonp"==this.type?[null]:[this.a])},B:function(){var a=this.a,b=this.result.data;this.i("success","jsonp"==this.type?[b,200,null]:[b,a.status,a])},u:function(){this.i("abort","jsonp"==this.type?[null]:[this.a])},A:function(){var a=this.a;this.i("error","jsonp"==this.type?["",0,null,null,this.c]:[a.responseText,a.status,a,this.ea,null])},i:function(a,b){function d(){}a=e.handlers[a];b.push(this.requestId,this.url,this.type);for(var c=0,f=a.length;c<f;c+=1)d=a[c],"function"==typeof d&&d.apply(null,
b)},H:function(){var a=window,b=this.requestId,d=this.url,c=this.type,f=this.f,h=this.c,g=this.a;a.console&&("jsonp"==c?a.console.log(b,d,c,0,h):a.console.log(b,d,c,g,g.status,g.responseText,f,f.stack))},M:function(){var a=this.toString();return a.substr(8,a.length-9)}};return e}()})("undefined"!==typeof window?window:"undefined"!==typeof global?global:this);
